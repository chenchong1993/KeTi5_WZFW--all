<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <meta name="viewport" content="initial-scale=1, maximum-scale=1,user-scalable=no"/>
    <title>动态热力图渲染</title>
    <link rel="stylesheet" type="text/css" href="{{ asset('static/Ips_api_javascript/dijit/themes/tundra/tundra.css') }}"/>
    <link rel="stylesheet" type="text/css" href="{{ asset('static/Ips_api_javascript/esri/css/esri.css') }}" />
    <script src="{{ asset('Ips_api_javascript/echartsExtent.js') }}"></script>
    <script>
        var dojoConfig={
            async: true,
            packages: [{
                name: "src",
                location: location.pathname.replace(/\/[^/]+$/, "")+"/src"
            }]
        }
    </script>
    <script type="text/javascript" src="{{ asset('static/Ips_api_javascript/init.js') }}"></script>
    <style>
        html, body, #map {
            height: 100%;
            width: 100%;
            margin: 0;
            padding: 0;
        }
        body {
            background-color: #FFF;
            overflow: hidden;
            font-family: "Trebuchet MS", sans-serif;
        }
        #render{
            position: absolute;top:30px;left:200px;font-size: 18px;
        }
        #del{position: absolute;top:70px;left:200px;font-size: 18px;}
    </style>
</head>
<body>
<div id="map"></div>
<button id="render">热力图渲染</button>
<button id="del">移除热力图</button>

<script>
    var map;
    require(["esri/map",
        "src/Echarts3Layer",
        "dojo/on",
        "dojo/dom",
        "dojo/domReady!"], function (Map,Echarts3Layer,on,dom) {
        map = new Map("map", {
            basemap: "gray",
            center: [114.435,38.049],
            zoom: 15,
            logo:false
        });
        on(dom.byId("render"),"click", function () {
            //初始化echarts图层
            var overlay = new Echarts3Layer(map, echarts);
            var chartsContainer = overlay.getEchartsContainer();
            var myChart = overlay.initECharts(chartsContainer);

            //轨迹点数据
            var point=[
                [114.430941000000000,38.057633860000003],[114.431135000000000,38.057644109999998],[114.431331000000000,38.057646239999997],[114.431374000000010,38.057647719999999],[114.431639000000000,38.057647240000001],[114.431873000000000,38.057650080000002],[114.432064000000000,38.057652410000003],[114.432299000000000,38.057655269999998],[114.432473000000000,38.057657399999997],[114.432512000000000,38.057655810000000],[114.432702000000010,38.057667889999998],[114.432706000000000,38.057670060000000],[114.432897999999990,38.057665470000003],[114.433075000000000,38.057667039999998],[114.433260000000000,38.057668669999998],[114.433458000000000,38.057670420000001],[114.433652000000000,38.057672130000000],[114.433502000000000,38.057671780000000],[114.433601000000000,38.057666320000003],[114.433797000000000,38.057678299999999],[114.434005000000000,38.057679589999999],[114.434192999999990,38.057680750000003],[114.434285000000000,38.057683460000000],[114.434482000000000,38.057670469999998],[114.434718000000000,38.057671669999998],[114.434921000000000,38.057672689999997],[114.435120000000000,38.057675260000003],[114.435336000000010,38.057801589999997],[114.435543000000000,38.057919380000001],[114.435591000000000,38.057993869999997],[114.435807999999990,38.058107530000001],[114.435982999999990,38.058209349999998],[114.436165000000000,38.058315890000003],[114.436173000000000,38.058324450000001],[114.436362000000000,38.058498239999999],[114.436567999999990,38.058676009999999],[114.436749000000010,38.058811550000001],[114.436832999999990,38.058791370000002],[114.436967999999990,38.058744810000000],[114.437140000000000,38.058448790000000],[114.437185000000000,38.058366399999997],[114.437219000000000,38.058158339999999],[114.437111000000000,38.057920230000001],[114.437065000000000,38.057744499999998],[114.436931000000000,38.057540729999999],[114.437017999999990,38.057475040000000],[114.437144000000000,38.057424529999999],[114.437223000000000,38.057341059999999],[114.437226999999990,38.057280440000000],[114.437226999999990,38.057056459999998],[114.437404000000000,38.056854899999998],[114.437398000000000,38.056850060000002],[114.437382000000000,38.056630290000001],[114.437582000000010,38.056464400000003],[114.437822999999990,38.056261069999998],[114.438014999999990,38.056099699999997],[114.438247000000000,38.055903989999997],[114.438275000000000,38.055830800000003],[114.438367000000000,38.055683279999997],[114.438608000000000,38.055488290000000],[114.438850000000000,38.055286209999998],[114.439088000000000,38.055087489999998],[114.439312000000000,38.054900160000003],[114.439525000000000,38.054721669999999],[114.439699000000000,38.054576869999998],[114.439601000000000,38.054465520000001],[114.439648000000010,38.054374390000000],[114.439843999999990,38.054170249999999],[114.440032000000000,38.053981250000000],[114.440212000000000,38.053757189999999],[114.440423000000000,38.053491309999998],[114.440641000000000,38.053292110000001],[114.440687999999990,38.053242939999997],[114.440742000000000,38.053164379999998],[114.440757000000000,38.053162579999999],[114.440794999999990,38.053161250000002],[114.441049000000010,38.052908109999997],[114.441253000000000,38.052696800000000],[114.441458999999990,38.052483100000003],[114.441646000000010,38.052290159999998],[114.441886999999990,38.052040759999997],[114.442091000000000,38.051829599999998],[114.442296000000000,38.051617780000001],[114.442447000000000,38.051447340000003],[114.442457000000000,38.051429890000001],[114.442482000000000,38.051404060000003],[114.442656000000000,38.051195829999997],[114.442836000000000,38.051016570000002],[114.442997000000010,38.050847970000000],[114.443225000000000,38.050606870000003],[114.443433000000000,38.050378330000001],[114.443674000000000,38.050113490000001],[114.443903000000010,38.049861749999998],[114.444126000000000,38.049615529999997],[114.444368000000000,38.049349290000002],[114.444565000000000,38.049133110000000],[114.444783000000000,38.048893010000000],[114.444948999999990,38.048875780000003],[114.445100000000000,38.048728130000001],[114.445099000000000,38.048566280000003],[114.445104000000000,38.048414399999999],[114.445108000000000,38.048317580000003],[114.445151999999990,38.047818980000002],[114.445181000000010,38.047698099999998],[114.445185000000000,38.047556940000000],[114.445196999999990,38.047551329999997],[114.445188000000000,38.047545000000000],[114.445226000000010,38.047177290000000],[114.445243000000000,38.046757280000001],[114.445303000000000,38.045955450000001],[114.445308000000000,38.045772100000001],[114.445324000000000,38.045708630000000],[114.445340000000000,38.045583290000003],[114.445363000000000,38.045292730000000],[114.445412000000000,38.044811070000002],[114.445464000000000,38.044225810000000],[114.445465000000000,38.044155510000003],[114.445490000000010,38.044089960000001],[114.445567999999990,38.042383809999997],[114.445625000000010,38.041266440000001],[114.445649000000000,38.041006879999998],[114.445656000000000,38.040962510000000],[114.445667000000000,38.040822849999998],[114.445672000000000,38.040680700000003],[114.445677000000000,38.040547949999997],[114.445682000000010,38.040408880000001],[114.445687000000010,38.040245810000002],[114.445699000000000,38.040134840000000],[114.445696000000000,38.039993060000000],[114.445702000000000,38.039817859999999],[114.445708999999990,38.039637120000002],[114.445714000000000,38.039585729999999],[114.445719999999990,38.039431800000003],[114.445725999999990,38.039254610000000],[114.445732000000010,38.039080079999998],[114.445727000000010,38.039068810000003],[114.445745000000000,38.038871600000000],[114.445742999999990,38.038853719999999],[114.445742999999990,38.038695160000003],[114.445751000000000,38.038618120000002],[114.445758000000000,38.038475320000003],[114.445763000000000,38.038321600000003],[114.445769000000000,38.038160110000000],[114.445780000000000,38.038004510000000],[114.445982000000000,38.038012400000000],[114.446166000000010,38.038008179999999],[114.446353000000000,38.038003910000000],[114.446550000000000,38.037999380000002],[114.446561000000000,38.037997519999998],[114.446751000000010,38.037983900000000],[114.446943000000000,38.037987870000002],[114.447136000000000,38.037991880000000],[114.447326000000000,38.037995809999998],[114.447534000000000,38.038000120000000],[114.447757999999990,38.038004749999999],[114.447963000000000,38.038009740000000],[114.448010000000000,38.037550609999997],[114.448013000000000,38.037402729999997],[114.448016000000000,38.037349229999997]
            ]

            //热力图配置
            var option = {
                title: {
                    text: '',
                    left: 'center',
                    textStyle: {
                        color: '#fff'
                    }
                },
                visualMap: {
                    min: 0,
                    max: 2,
                    show: false,
                    seriesIndex: 0,
                    calculable: true,
                    inRange: {
                        color: ['blue', 'blue', 'green', 'yellow', 'red'] //色带
                    },
                    textStyle: {
                        color: '#fff'
                    }
                },
                geo: {
                    map: '',
                    show: false,
                    label: {
                        emphasis: {
                            show: false
                        }
                    },
                    left: 0,
                    top: 0,
                    right: 0,
                    bottom: 0,
                    roam: false,
                    itemStyle: {
                        normal: {
                            areaColor: '#323c48',
                            borderColor: '#111'
                        },
                        emphasis: {
                            areaColor: '#2a333d'
                        }
                    }
                },
                series: [{
                    type: 'heatmap', //effectScatter
                    coordinateSystem: 'geo',
                    data: point, //渲染数据【点数组】
                    pointSize: 8,  //点大小
                    blurSize: 30  //模糊大小
                }]
            };
            // 使用刚指定的配置项和数据显示图表。
            overlay.setOption(option);

            on(dom.byId("del"),"click",function(){
                //移除渲染效果
                chartsContainer.remove();
            })
        });

    });
</script>
</body>
</html>
